{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Welcome to AWS Services Workshop From the workshop menu please navigate to the workshop you'd like to explore.","title":"Home"},{"location":"index.html#welcome-to-aws-services-workshop","text":"From the workshop menu please navigate to the workshop you'd like to explore.","title":"Welcome to AWS Services Workshop"},{"location":"grc341/index.html","text":"Welcome to re:Inforce 2019 Introduction This AWS Continuous Server Hardening workshop is a hands-on session designed to show attendees how they can continuously keep their linux servers hardened with the Center for Internet Security (CIS) benchmarks using AWS Systems Manager , CodeCommit , AWS CodeBuild , AWS CodeDeploy and AWS CodePipeline . Pre-requisites An internet connected laptop with the following installed: Integrated Development Environment (IDE) Git AWS Command Line Interface (CLI) SSH client installed AWS account with admin privileges Intermediate AWS experience","title":"Introduction"},{"location":"grc341/index.html#welcome-to-reinforce-2019","text":"","title":"Welcome to re:Inforce 2019"},{"location":"grc341/index.html#introduction","text":"This AWS Continuous Server Hardening workshop is a hands-on session designed to show attendees how they can continuously keep their linux servers hardened with the Center for Internet Security (CIS) benchmarks using AWS Systems Manager , CodeCommit , AWS CodeBuild , AWS CodeDeploy and AWS CodePipeline .","title":"Introduction"},{"location":"grc341/index.html#pre-requisites","text":"An internet connected laptop with the following installed: Integrated Development Environment (IDE) Git AWS Command Line Interface (CLI) SSH client installed AWS account with admin privileges Intermediate AWS experience","title":"Pre-requisites"},{"location":"grc341/module-1.html","text":"Objective In this module we will create a CodeCommit repository to store our Ansible playbook and supporting files. We will also download the workshop artifacts that contain the Ansible playbook and copy them to our local repository While this should work in any commercial region, it was tested specifically in US-East-1. Prerequisites Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client. Create CodeCommit repository We need to create a code repository to store our Ansible playbook and supporting files. This will allow us to track changes to our playbook so that we can easily revert to a known working version if a change breaks a system. This will also integrate with AWS CodePipeline in a later step to trigger our pipeline. Click on the link below to launch the cloudformation template us-east-1 Name your repository Create IAM user If you don't already have an IAM user, create one now from the IAM console Upload SSH public key or generate HTTPS credentials for your IAM user Clone your repository Clone your repository using the Clone URL (HTTPS or SSH) Download workshop artifacts Download reinforce-demo.zip Unzip reinforce-demo.zip and copy the contents to your local repository. The folder/file structure should look similar to below: /local-repo .git Ansible-RHEL7-CIS-Benchmarks-master scripts appspec.yml Note : Do not commit your files at this point. We will need to make changes to buildspec.yml in order for the solution to work.","title":"Setting up your repository"},{"location":"grc341/module-1.html#objective","text":"In this module we will create a CodeCommit repository to store our Ansible playbook and supporting files. We will also download the workshop artifacts that contain the Ansible playbook and copy them to our local repository While this should work in any commercial region, it was tested specifically in US-East-1.","title":"Objective"},{"location":"grc341/module-1.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client.","title":"Prerequisites"},{"location":"grc341/module-1.html#create-codecommit-repository","text":"We need to create a code repository to store our Ansible playbook and supporting files. This will allow us to track changes to our playbook so that we can easily revert to a known working version if a change breaks a system. This will also integrate with AWS CodePipeline in a later step to trigger our pipeline. Click on the link below to launch the cloudformation template us-east-1 Name your repository","title":"Create CodeCommit repository"},{"location":"grc341/module-1.html#create-iam-user","text":"If you don't already have an IAM user, create one now from the IAM console Upload SSH public key or generate HTTPS credentials for your IAM user","title":"Create IAM user"},{"location":"grc341/module-1.html#clone-your-repository","text":"Clone your repository using the Clone URL (HTTPS or SSH)","title":"Clone your repository"},{"location":"grc341/module-1.html#download-workshop-artifacts","text":"Download reinforce-demo.zip Unzip reinforce-demo.zip and copy the contents to your local repository. The folder/file structure should look similar to below: /local-repo .git Ansible-RHEL7-CIS-Benchmarks-master scripts appspec.yml Note : Do not commit your files at this point. We will need to make changes to buildspec.yml in order for the solution to work.","title":"Download workshop artifacts"},{"location":"grc341/module-2.html","text":"Objective In this module we will create S3 buckets to store build artifacts and logs. We will also create an encryption key that will be used to encrypt data at rest. Lastly, we will create an IAM role that will give our EC2 instance permissions for AWS Systems Manager . While this should work in any commercial region, it was tested specifically in US-East-1. Prerequisites Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client. Create IAM role We need to create a role for our instance so that it can download the Ansible playbook from our artifacts bucket later. Click on the link below to launch the cloudformation template us-east-1 Provide a name for your role Setting up S3 bucket for build artifacts We will create an S3 bucket to store our artifacts. This will be used by AWS CodeBuild to store our build artifacts. The instance will reference this bucket later to download the Ansible playbook. Make sure to fill in all of the parameters. NOTE : S3 bucket names are globally unique. If you get an error that a bucket already exists try a new name Click on the link below to launch the cloudformation template us-east-1 In this step we are creating an S3 bucket policy and applying it to the bucket created in the previous step. This will grant the role created earlier access to download the artifacts. Make sure to fill in all of the parameters. The parameters ArtifactsBucketName and S3Bucket must match the name of the artifacts bucket created earlier. RolePrincipal must match the name of the IAM role created earlier. Click on the link below to launch the cloudformation template us-east-1 Setting up S3 bucket for logging We will now create an S3 bucket to store logs for troubleshooting purposes. If we encounter errors the logs may help us identify what went wrong. Make sure to fill in all of the parameters. NOTE : S3 bucket names are globally unique. If you get an error that a bucket already exists try a new name Click on the link below to launch the cloudformation template us-east-1 Create KMS Key for encryption Here we will create a KMS encryption key that will be used by CodeBuild to encrypt our build artifacts in S3. Make sure to replace user/$user with the name of the IAM user created earlier. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up supporting infrastructure"},{"location":"grc341/module-2.html#objective","text":"In this module we will create S3 buckets to store build artifacts and logs. We will also create an encryption key that will be used to encrypt data at rest. Lastly, we will create an IAM role that will give our EC2 instance permissions for AWS Systems Manager . While this should work in any commercial region, it was tested specifically in US-East-1.","title":"Objective"},{"location":"grc341/module-2.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client.","title":"Prerequisites"},{"location":"grc341/module-2.html#create-iam-role","text":"We need to create a role for our instance so that it can download the Ansible playbook from our artifacts bucket later. Click on the link below to launch the cloudformation template us-east-1 Provide a name for your role","title":"Create IAM role"},{"location":"grc341/module-2.html#setting-up-s3-bucket-for-build-artifacts","text":"We will create an S3 bucket to store our artifacts. This will be used by AWS CodeBuild to store our build artifacts. The instance will reference this bucket later to download the Ansible playbook. Make sure to fill in all of the parameters. NOTE : S3 bucket names are globally unique. If you get an error that a bucket already exists try a new name Click on the link below to launch the cloudformation template us-east-1 In this step we are creating an S3 bucket policy and applying it to the bucket created in the previous step. This will grant the role created earlier access to download the artifacts. Make sure to fill in all of the parameters. The parameters ArtifactsBucketName and S3Bucket must match the name of the artifacts bucket created earlier. RolePrincipal must match the name of the IAM role created earlier. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up S3 bucket for build artifacts"},{"location":"grc341/module-2.html#setting-up-s3-bucket-for-logging","text":"We will now create an S3 bucket to store logs for troubleshooting purposes. If we encounter errors the logs may help us identify what went wrong. Make sure to fill in all of the parameters. NOTE : S3 bucket names are globally unique. If you get an error that a bucket already exists try a new name Click on the link below to launch the cloudformation template us-east-1","title":"Setting up S3 bucket for logging"},{"location":"grc341/module-2.html#create-kms-key-for-encryption","text":"Here we will create a KMS encryption key that will be used by CodeBuild to encrypt our build artifacts in S3. Make sure to replace user/$user with the name of the IAM user created earlier. Click on the link below to launch the cloudformation template us-east-1","title":"Create KMS Key for encryption"},{"location":"grc341/module-3.html","text":"Objective In this module we will create a AWS CodeBuild Project to copy our files from our repository to S3. This will allow us to reference the playbook url in S3 in our Systems Manager State Manager association in a later step. While this should work in any commercial region, it was tested specifically in US-East-1. Prerequisites Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client. Setting up your build project We will create a AWS CodeBuild project that will take the code in our repository and create a zip file that CodeDeploy will use to deploy our Ansible playbook to our instances. Make sure to fill in all of the parameters. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up your build project"},{"location":"grc341/module-3.html#objective","text":"In this module we will create a AWS CodeBuild Project to copy our files from our repository to S3. This will allow us to reference the playbook url in S3 in our Systems Manager State Manager association in a later step. While this should work in any commercial region, it was tested specifically in US-East-1.","title":"Objective"},{"location":"grc341/module-3.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client.","title":"Prerequisites"},{"location":"grc341/module-3.html#setting-up-your-build-project","text":"We will create a AWS CodeBuild project that will take the code in our repository and create a zip file that CodeDeploy will use to deploy our Ansible playbook to our instances. Make sure to fill in all of the parameters. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up your build project"},{"location":"grc341/module-4.html","text":"Objective In this module we will create a AWS CodeDeploy application and deployment group. This will be used to deploy the Ansible playbook to our instance(s). While this should work in any commercial region, it was tested specifically in US-East-1. Prerequisites Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client. Setting up your application and deployment group We will create a AWS CodeDeploy application and deployment group. The deployment group is used to define the target instances to deploy the artifacts to. Make sure to fill in all of the parameters. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up your application"},{"location":"grc341/module-4.html#objective","text":"In this module we will create a AWS CodeDeploy application and deployment group. This will be used to deploy the Ansible playbook to our instance(s). While this should work in any commercial region, it was tested specifically in US-East-1.","title":"Objective"},{"location":"grc341/module-4.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client.","title":"Prerequisites"},{"location":"grc341/module-4.html#setting-up-your-application-and-deployment-group","text":"We will create a AWS CodeDeploy application and deployment group. The deployment group is used to define the target instances to deploy the artifacts to. Make sure to fill in all of the parameters. Click on the link below to launch the cloudformation template us-east-1","title":"Setting up your application and deployment group"},{"location":"grc341/module-5.html","text":"Objective In this module we will create a AWS Systems Manager State Manager Association to run the Ansible playbook on our instance(s) every 30 mins. This is where we enforce the continuous hardening by ensuring that our instance(s) always has the latest configuration. While this should work in any commercial region, it was tested specifically in US-East-1. Prerequisites Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client. Setting up the Systems Manager State Manager Association Here we will create a AWS Systems Manager State Manager association using the RunAnsiblePlaybook document. Systems Manager will reference the artifacts bucket created earlier to run the Ansible playbook. In this template we scheduled the association to run the playbook every 30 mins. This could be customized to meet your needs. Click on the link below to launch the cloudformation template us-east-1 The playbook url will be similar to: s3://YOUR_ARTIFACTS_BUCKET/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml","title":"Setting up SSM"},{"location":"grc341/module-5.html#objective","text":"In this module we will create a AWS Systems Manager State Manager Association to run the Ansible playbook on our instance(s) every 30 mins. This is where we enforce the continuous hardening by ensuring that our instance(s) always has the latest configuration. While this should work in any commercial region, it was tested specifically in US-East-1.","title":"Objective"},{"location":"grc341/module-5.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access AWS CLI set up on the local client.","title":"Prerequisites"},{"location":"grc341/module-5.html#setting-up-the-systems-manager-state-manager-association","text":"Here we will create a AWS Systems Manager State Manager association using the RunAnsiblePlaybook document. Systems Manager will reference the artifacts bucket created earlier to run the Ansible playbook. In this template we scheduled the association to run the playbook every 30 mins. This could be customized to meet your needs. Click on the link below to launch the cloudformation template us-east-1 The playbook url will be similar to: s3://YOUR_ARTIFACTS_BUCKET/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml","title":"Setting up the Systems Manager State Manager Association"},{"location":"grc341/module-6.html","text":"Objective In this module we will update our buildspec.yml file with the artifacts bucket we created in an earlier module. Prerequisites Ensure you are logged into an AWS account with admin access Completed Setting up supporting infrastructure module Laptop with an IDE and git installed Update buildspec.yml Navigate to your local repository where you copied the contents of reinforce-demo.zip from an earlier module Open buildspec.yml in your IDE Edit buildspec.yml by replacing YOUR_ARTIFACTS_BUCKET_NAME with the name of the artifacts bucket created in an earlier module build: commands: - aws s3 cp --recursive --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/roles s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/roles - aws s3 cp --acl bucket-owner-full-control ./appspec.yml s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/appspec.yml - aws s3 cp --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml - aws s3 cp --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/ansible.cfg s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/ansible.cfg - aws s3 cp --recursive --acl bucket-owner-full-control ./scripts s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/scripts Once you've updated buildspec.yml you can commit your changes to your origin","title":"Update buildspec"},{"location":"grc341/module-6.html#objective","text":"In this module we will update our buildspec.yml file with the artifacts bucket we created in an earlier module.","title":"Objective"},{"location":"grc341/module-6.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access Completed Setting up supporting infrastructure module Laptop with an IDE and git installed","title":"Prerequisites"},{"location":"grc341/module-6.html#update-buildspecyml","text":"Navigate to your local repository where you copied the contents of reinforce-demo.zip from an earlier module Open buildspec.yml in your IDE Edit buildspec.yml by replacing YOUR_ARTIFACTS_BUCKET_NAME with the name of the artifacts bucket created in an earlier module build: commands: - aws s3 cp --recursive --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/roles s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/roles - aws s3 cp --acl bucket-owner-full-control ./appspec.yml s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/appspec.yml - aws s3 cp --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/playbook.yml - aws s3 cp --acl bucket-owner-full-control ./Ansible-RHEL7-CIS-Benchmarks-master/ansible.cfg s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/Ansible-RHEL7-CIS-Benchmarks-master/ansible.cfg - aws s3 cp --recursive --acl bucket-owner-full-control ./scripts s3://YOUR_ARTIFACTS_BUCKET_NAME/cis-rhel-ansible-master/scripts Once you've updated buildspec.yml you can commit your changes to your origin","title":"Update buildspec.yml"},{"location":"grc341/module-7.html","text":"Objective In this module we will provision and configure our instance(s) to receive the files necessary for the Ansible playbook to run. Prerequisites Ensure you are logged into an AWS account with admin access Completed all previous modules SSH Client to remote into your linux instance(s) Existing VPC with public/private subnets and outbound internet access Provision Red Hat Enterprise Linux 7 instance Navigate to the marketplace and search for Linux 7 Select Red Hat Enterprise Linux (RHEL) 7 (HVM) On Step 2: Choose an Instance Type select t2.micro On Step 3: Configure Instance Details provision the instance in a subnet that you have access to For IAM role select the IAM role created in Setting up supporting infrastructure On Step 5: Add Tags add the following tag Key:Deploy Value:CIS . CodeDeploy will use these tags to target instances to deploy the Ansible playbook On Step 6: Configure Security Group configure SSH access Launch your instance(s) Note : Ideally we would provision the instance in a private subnet and connect over VPN. If you do not have a VPN configured for your VPC, you can provision the instance in a public subnet for this workshop. Make sure to lockdown SSH access to just your device. Configure instance(s) First, we need to update our instance(s) sudo yum update -y Install epel-repo sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm Install pip sudo yum install wget -y sudo wget https://bootstrap.pypa.io/get-pip.py sudo python get-pip.py Install Ansible sudo pip install ansible Install AWS cli sudo pip install awscli Install SSM agent sudo yum install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm Install CodeDeploy agent sudo yum install -y ruby cd /home/ec2-user sudo wget https://aws-codedeploy-us-east-1.s3.amazonaws.com/latest/install sudo chmod +x ./install sudo ./install auto Make sure SSM and CodeDeploy agents are running sudo systemctl status amazon-ssm-agent sudo service codedeploy-agent status The instance is now configured with Ansible, SSM and CodeDeploy agents and is ready to receive and run the ansible playbook from the reinforce-demo artifacts.","title":"Provision and Configure Instance(s)"},{"location":"grc341/module-7.html#objective","text":"In this module we will provision and configure our instance(s) to receive the files necessary for the Ansible playbook to run.","title":"Objective"},{"location":"grc341/module-7.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access Completed all previous modules SSH Client to remote into your linux instance(s) Existing VPC with public/private subnets and outbound internet access","title":"Prerequisites"},{"location":"grc341/module-7.html#provision-red-hat-enterprise-linux-7-instance","text":"Navigate to the marketplace and search for Linux 7 Select Red Hat Enterprise Linux (RHEL) 7 (HVM) On Step 2: Choose an Instance Type select t2.micro On Step 3: Configure Instance Details provision the instance in a subnet that you have access to For IAM role select the IAM role created in Setting up supporting infrastructure On Step 5: Add Tags add the following tag Key:Deploy Value:CIS . CodeDeploy will use these tags to target instances to deploy the Ansible playbook On Step 6: Configure Security Group configure SSH access Launch your instance(s) Note : Ideally we would provision the instance in a private subnet and connect over VPN. If you do not have a VPN configured for your VPC, you can provision the instance in a public subnet for this workshop. Make sure to lockdown SSH access to just your device.","title":"Provision Red Hat Enterprise Linux 7 instance"},{"location":"grc341/module-7.html#configure-instances","text":"First, we need to update our instance(s) sudo yum update -y Install epel-repo sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm Install pip sudo yum install wget -y sudo wget https://bootstrap.pypa.io/get-pip.py sudo python get-pip.py Install Ansible sudo pip install ansible Install AWS cli sudo pip install awscli Install SSM agent sudo yum install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm Install CodeDeploy agent sudo yum install -y ruby cd /home/ec2-user sudo wget https://aws-codedeploy-us-east-1.s3.amazonaws.com/latest/install sudo chmod +x ./install sudo ./install auto Make sure SSM and CodeDeploy agents are running sudo systemctl status amazon-ssm-agent sudo service codedeploy-agent status The instance is now configured with Ansible, SSM and CodeDeploy agents and is ready to receive and run the ansible playbook from the reinforce-demo artifacts.","title":"Configure instance(s)"},{"location":"grc341/module-8.html","text":"Objective In this module we will create the pipeline to autoomate the deployment of the Ansible playbook as changes are made. Prerequisites Ensure you are logged into an AWS account with admin access Completed all previous modules Laptop with an IDE and git installed Create pipeline In the Source stage, for Action Provider select AWS CodeCommit For Repository name select the repository created in module-1 from the drop down For Branch name select the branch to monitor for changes from the drop down In the Build stage, for Action Provider select AWS CodeBuild For Project name select the project created in module-3 from the drop down In the Deploy stage, for Action Provider select AWS CodeDeploy For Application name select the application created in module-4 from the drop down For Deployment group select the deployment group created in module-4 from the drop down Review and create pipeline Your pipeline should look similar to the below pipeline.","title":"Setting up CodePipeline"},{"location":"grc341/module-8.html#objective","text":"In this module we will create the pipeline to autoomate the deployment of the Ansible playbook as changes are made.","title":"Objective"},{"location":"grc341/module-8.html#prerequisites","text":"Ensure you are logged into an AWS account with admin access Completed all previous modules Laptop with an IDE and git installed","title":"Prerequisites"},{"location":"grc341/module-8.html#create-pipeline","text":"In the Source stage, for Action Provider select AWS CodeCommit For Repository name select the repository created in module-1 from the drop down For Branch name select the branch to monitor for changes from the drop down In the Build stage, for Action Provider select AWS CodeBuild For Project name select the project created in module-3 from the drop down In the Deploy stage, for Action Provider select AWS CodeDeploy For Application name select the application created in module-4 from the drop down For Deployment group select the deployment group created in module-4 from the drop down Review and create pipeline Your pipeline should look similar to the below pipeline.","title":"Create pipeline"}]}